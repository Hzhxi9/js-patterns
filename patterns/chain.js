/**
 * @description èŒè´£é“¾æ¨¡å¼
 *
 *    å®šä¹‰: ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚, ä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹‹é—´çš„è€¦åˆå…³ç³», å°†è¿™äº›å¯¹è±¡è¿åŸä¸€æ¡é“¾, å¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚
 *         ç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†ä»–ä¸ºæ­¢
 *         ä¸€ç³»åˆ—å¯èƒ½ä¼šå¤„ç†è¯·æ±‚çš„å¯¹è±¡è¢«è¿æ¥æˆä¸€æ¡é“¾, è¯·æ±‚åœ¨è¿™äº›å¯¹è±¡ä¹‹é—´ä¾æ¬¡ä¼ é€’, ç›´åˆ°é‡åˆ°ä¸€ä¸ªå¯ä»¥å¤„ç†å®ƒçš„å¯¹è±¡, æˆ‘ä»¬æŠŠè¿™äº›å¯¹è±¡ç§°ä¸ºé“¾ä¸­çš„èŠ‚ç‚¹
 *
 *    ä¼˜ç‚¹: è¯·æ±‚å‘é€è€…åªéœ€è¦çŸ¥é“é“¾ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹, ä»è€Œå¼±åŒ–äº†å‘é€è€…å’Œä¸€ç»„æ¥æ”¶è€…ä¹‹é—´çš„å¼ºè”ç³»
 *
 */

/**
 * ğŸŒ° : å®é™…å¼€å‘ä¸­çš„èŒè´£é“¾æ¨¡å¼
 *
 *  å‡å¦‚æˆ‘ä»¬è´Ÿè´£ä¸€ä¸ªå”®å–æ‰‹æœºçš„ç”µå•†ç½‘ç«™, ç»è¿‡åˆ†åˆ«äº¤çº³ 500 å…ƒå®šé‡‘å’Œ 200 å…ƒå®šé‡‘é¢„å®šå(è®¢å•å·²ç»åœ¨æ­¤æ—¶ç”Ÿæˆ), ç°åœ¨å·²ç»åˆ°äº†æ­£å¼è´­ä¹°çš„é˜¶æ®µ
 *
 *  å…¬å¸é’ˆå¯¹æ”¯ä»˜è¿‡å®šé‡‘çš„ç”¨æˆ·æœ‰ä¸€å®šçš„ä¼˜æƒ æ”¿ç­–, åœ¨æ­£å¼è´­ä¹°å,
 *      - å·²ç»æ”¯ä»˜è¿‡ 500 å…ƒå®šé‡‘çš„ç”¨æˆ·ä¼šæ”¶åˆ° 100 å…ƒçš„å•†åœºä¼˜æƒ åˆ¸
 *      - å·²ç»æ”¯ä»˜è¿‡ 200 å…ƒå®šé‡‘çš„ç”¨æˆ·ä¼šæ”¶åˆ° 50 å…ƒçš„å•†åœºä¼˜æƒ åˆ¸
 *      - æ²¡æœ‰æ”¯ä»˜è¿‡ å®šé‡‘ çš„ç”¨æˆ·åªèƒ½è¿›å…¥æ™®é€šè´­ä¹°æ¨¡å¼, ä¹Ÿå°±æ˜¯æ²¡æœ‰ä¼˜æƒ åˆ¸, ä¸”åœ¨åº“å­˜æœ‰é™çš„æƒ…å†µä¸‹ä¸ä¸€å®šä¿è¯èƒ½ä¹°åˆ°
 *
 *  æ¥å£æä¾›å­—æ®µ:
 *      orderType: è®¢å•ç±»å‹(å®šé‡‘ç”¨æˆ·ï½œæ™®é€šç”¨æˆ·), code: 1 => 500 å…ƒå®šé‡‘ç”¨æˆ·, 2 => 200 å…ƒå®šé‡‘ç”¨æˆ·, 3 => æ™®é€šè´­ä¹°ç”¨æˆ·
 *      pay: ç”¨æˆ·æ˜¯å¦å·²ç»æ”¯ä»˜å®šé‡‘, å€¼ä¸º true æˆ–è€… false, è™½ç„¶ç”¨æˆ·å·²ç»ä¸‹è¿‡äº† 500 å…ƒå®šé‡‘çš„è®¢å•, ä½†ä»–å¦‚æœæ²¡æœ‰æ”¯ä»˜å®šé‡‘, åªèƒ½é™çº§ä¸ºæ™®é€šè´­ä¹°ç”¨æˆ·
 *      stock: å½“å‰ç”¨äºæ™®é€šè´­ä¹°çš„æ‰‹æœºåº“å­˜æ•°é‡, å·²ç»æ”¯ä»˜è¿‡ 500 å…ƒå®šé‡‘å’Œ 200 å…ƒå®šé‡‘çš„ç”¨æˆ·ä¸å—æ­¤é™åˆ¶
 **/
var order = function (orderType, pay, stock) {
  /**500 å…ƒå®šé‡‘æ¨¡å¼ */
  if (orderType === 1) {
    /**å·²æ”¯ä»˜è¿‡å®šé‡‘ */
    if (pay === true) {
      console.log('500 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 100 å…ƒä¼˜æƒ åˆ¸');
    } else {
      /**æœªæ”¯ä»˜è¿‡å®šé‡‘, é™çº§ä¸ºæ™®é€šè´­ä¹°æ¨¡å¼ */
      if (stock > 0) {
        /**ç”¨äºæ™®é€šè´­ä¹°æ¨¡å¼ä¸”æœ‰åº“å­˜ */
        console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
      } else {
        /**æ²¡æœ‰åº“å­˜ */
        console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
      }
    }
  } else if (orderType === 2) {
    /**200 å…ƒå®šé‡‘æ¨¡å¼ */
    if (pay === true) {
      console.log('200 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 50 å…ƒä¼˜æƒ åˆ¸');
    } else {
      if (stock > 0) {
        console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
      } else {
        console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
      }
    }
  } else if (orderType === 3) {
    /**æ™®é€šè´­ä¹°æ¨¡å¼ */
    if (stock > 0) {
      console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
    } else {
      console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
    }
  }
};
order(1, true, 500);

/**
 * ğŸŒ° : èŒè´£é“¾æ¨¡å¼é‡æ„
 *
 * 1. å…ˆæŠŠ 500, 200, æ™®é€šè´­ä¹°åˆ†æˆ 3 ä¸ªå‡½æ•°
 * 2. æŠŠä¸‰ä¸ªå­—æ®µä¼ é€’ç»™ 500 å‡½æ•°, ä¸ç¬¦åˆå¤„ç†æ¡ä»¶, åˆ™æŠŠè¿™ä¸ªè¯·æ±‚ä¼ é€’ç»™åé¢çš„ 200 å‡½æ•°, å¦‚æœä¾ç„¶ä¸èƒ½å¤„ç†, åˆ™ç»§ç»­ä¼ é€’ç»™æ™®é€šè´­ä¹°å‡½æ•°
 *
 * ç¼ºç‚¹:
 *    è¯·æ±‚åœ¨é“¾æ¡ä¼ é€’ä¸­çš„é¡ºåºéå¸¸åƒµç¡¬, ä¼ é€’è¯·æ±‚çš„ä»£ç è¢«è€¦åˆåœ¨äº†ä¸šåŠ¡å‡½æ•°ä¸­
 *    è¿™ä¾ç„¶è¿èƒŒäº†å¼€æ”¾å°é—­åŸåˆ™, å¦‚æœæˆ‘ä»¬æƒ³è¦å¢åŠ  300 å…ƒè®¢å•æˆ–è€…å»æ‰ 200 å…ƒè®¢å•, æ„å‘³ç€å°±å¿…é¡»æ”¹åŠ¨è¿™äº›ä¸šåŠ¡å‡½æ•°ä»£ç 
 */
var order500 = function (orderType, pay, stock) {
  if (orderType === 1 && pay) {
    console.log('500 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 100 å…ƒä¼˜æƒ åˆ¸');
  } else {
    /**ä¼ é€’ç»™ 200 å‡½æ•° */
    order200(orderType, pay, stock);
  }
};

var order200 = function (orderType, pay, stock) {
  if (orderType === 2 && pay) {
    console.log('200 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 50 å…ƒä¼˜æƒ åˆ¸');
  } else {
    /**ä¼ é€’ç»™ æ™®é€šè®¢å•å‡½æ•° */
    order200(orderType, pay, stock);
  }
};

var orderNormal = function (orderType, pay, stock) {
  if (stock > 0) {
    console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
  } else {
    console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
  }
};

/**
 * ğŸŒ° : çµæ´»å¯æ‹†åˆ†çš„èŒè´£é“¾èŠ‚ç‚¹
 *
 * ç›®æ ‡: è®©é“¾ä¸­çš„å„ä¸ªèŠ‚ç‚¹å¯ä»¥çµæ´»æ‹†åˆ†å’Œé‡ç»„
 */

/**
 * 1. åˆ†åˆ«æ”¹å†™è¡¨ç¤ºä¸‰ç§è´­ä¹°æ¨¡å¼çš„èŠ‚ç‚¹å‡½æ•°,
 *    çº¦å®šå¦‚æœæŸä¸ªèŠ‚ç‚¹ä¸èƒ½å¤„ç†è¯·æ±‚,
 *    åˆ™è¿”å›ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸² "nextSuccessor" æ¥è¡¨ç¤ºè¯¥è¯·æ±‚éœ€è¦ç»§ç»­å¾€åä¼ é€’
 **/
var order500 = function (orderType, pay, stock) {
  if (orderType === 1 && pay) {
    console.log('500 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 100 å…ƒä¼˜æƒ åˆ¸');
  } else {
    /**ä¸çŸ¥é“ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è°, åæ­£æŠŠè¯·æ±‚åä¼  */
    return 'nextSuccessor';
  }
};

var order200 = function (orderType, pay, stock) {
  if (orderType === 2 && pay) {
    console.log('200 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 50 å…ƒä¼˜æƒ åˆ¸');
  } else {
    /**ä¸çŸ¥é“ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è°, åæ­£æŠŠè¯·æ±‚åä¼  */
    return 'nextSuccessor';
  }
};

var orderNormal = function (orderType, pay, stock) {
  if (stock > 0) {
    console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
  } else {
    console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
  }
};

/**
 * 2. éœ€è¦æŠŠå‡½æ•°åŒ…è£…è¿›èŒè´£é“¾èŠ‚ç‚¹
 * æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•° Chain, åœ¨ new Chain çš„æ—¶å€™ä¼ é€’å‚æ•°å³ä¸ºè¢«åŒ…è£…çš„å‡½æ•°
 * åŒæ—¶å®ƒè¿˜æ‹¥æœ‰ä¸€ä¸ªå®ä¾‹å±æ€§ this.successor, è¡¨ç¤ºåœ¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
 * 
 * è‡ªç”±çµæ´»å¢åŠ ã€ç§»é™¤å’Œä¿®æ”¹é“¾ä¸­çš„èŠ‚ç‚¹é¡ºåº
 *
 * Chain çš„ prototype ä¸­è¿˜æœ‰ä¸¤ä¸ªå‡½æ•°:
 * Chain.prototype.setNextSuccessor: æŒ‡å®šåœ¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
 * Chain.prototype.passRequest: ä¼ é€’è¯·æ±‚ç»™æŸä¸ªèŠ‚ç‚¹
 */
var Chain = function (fn) {
  this.fn = fn;
  this.successor = null;
};

Chain.prototype.setNextSuccessor = function (successor) {
  return (this.successor = successor);
};

Chain.prototype.passRequest = function () {
  var ret = this.fn.apply(this, arguments);
  if (ret === 'nextSuccessor') {
    return this.successor && this.successor.passRequest.apply(this.successor, arguments);
  }
  return ret;
};

/**æŠŠä¸‰ä¸ªè®¢å•å‡½æ•°åŒ…è£…æˆèŒè´£é“¾çš„èŠ‚ç‚¹ */
var chainOrder500 = new Chain(order500);
var chainOrder200 = new Chain(order200);
var chainOrderNormal = new Chain(orderNormal);

/**æŒ‡å®šèŠ‚ç‚¹åœ¨èŒè´£é“¾ä¸­çš„é¡ºåº */
chainOrder500.setNextSuccessor(chainOrder200);
chainOrder200.setNextSuccessor(chainOrderNormal);

/**æŠŠè¯·æ±‚ä¼ é€’ç»™ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ */
chainOrder500.passRequest(1, true, 500);
chainOrder500.passRequest(2, true, 500);
chainOrder500.passRequest(3, true, 500);
chainOrder500.passRequest(1, false, 0);

/**å¢åŠ æ”¯æŒ 300 å…ƒå®šé‡‘è´­ä¹°, åœ¨é“¾ä¸­å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹å³å¯ */
var order300 = function(orderType, pay, stock){
    //
}
var chainOrder300 = new Chain(order300);
chainOrder500.setNextSuccessor(chainOrder300);
chainOrder300.setNextSuccessor(chainOrder200);
