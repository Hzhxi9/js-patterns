/**
 * å‘å¸ƒ-è®¢é˜…æ¨¡å¼(è§‚å¯Ÿè€…æ¨¡å¼)
 *    å®šä¹‰:
 *     -  å®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³», å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶, æ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥
 *     -  åœ¨ Javascript ä¸­æˆ‘ä»¬ä¸€èˆ¬ç”¨äº‹ä»¶æ¨¡å‹æ¥æ›¿ä»£ä¼ ç»Ÿçš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼
 *
 *    ä½œç”¨:
 *     - å¯ä»¥å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ä¸­, è¿™æ˜¯æ›¿ä»£ä¼ é€’å›è°ƒå‡½æ•°çš„æ–¹æ¡ˆ
 *       æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è®¢é˜… ajax è¯·æ±‚çš„ errorã€success ç­‰äº‹ä»¶
 *       æˆ–è€…å¦‚æœæƒ³åœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§å®Œæˆä¹‹ååšä¸€äº›äº‹æƒ…, é‚£æˆ‘ä»¬å¯ä»¥è®¢é˜…ä¸€ä¸ªäº‹ä»¶, ç„¶ååœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§å®Œæˆä¹‹åå‘å¸ƒè¿™ä¸ªäº‹ä»¶
 *       (åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼, æˆ‘ä»¬å°±æ— éœ€è¿‡å¤šå…³æ³¨å¯¹è±¡åœ¨å¼‚æ­¥è¿è¡ŒæœŸé—´çš„å†…éƒ¨çŠ¶æ€, è€Œåªéœ€è¦è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿç‚¹)
 *
 *     - å‘å¸ƒ-è®¢é˜…æ¨¡å¼å¯ä»¥å–ä»£å¯¹è±¡ä¹‹é—´ç¡¬ç¼–ç çš„é€šçŸ¥æœºåˆ¶, ä¸€ä¸ªå¯¹è±¡ä¸ç”¨æ˜¾ç¤ºè°ƒç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ¥å£
 *       å‘å¸ƒ-è®¢é˜…æ¨¡å¼è®©ä¸¤ä¸ªå¯¹è±¡æ¾è€¦åˆåœ°è”ç³»åœ¨ä¸€èµ·, è™½ç„¶ä¸æ¸…æ¥šå½¼æ­¤çš„ç»†èŠ‚, ä½†è¿™ä¹Ÿä¸å½±å“å®ƒä»¬ä¹‹é—´çš„ç›¸äº’é€šä¿¡
 *       å½“æœ‰æ–°çš„è®¢é˜…è€…å‡ºç°æ—¶, å‘å¸ƒè€…çš„ä»£ç ä¸éœ€è¦ä»»ä½•çš„ä¿®æ”¹
 *       åŒæ ·å‘å¸ƒè€…éœ€è¦æ”¹å˜, ä¹Ÿä¸ä¼šå½±å“åˆ°ä¹‹å‰çš„è®¢é˜…è€…( åªè¦ä¹‹å‰çº¦å®šçš„äº‹ä»¶åæ²¡æœ‰å˜åŒ–, å°±å¯ä»¥è‡ªç”±çš„æ”¹å˜å®ƒä»¬ )
 */

/**
 * ğŸŒ° : DOM äº‹ä»¶ (åœ¨ DOM èŠ‚ç‚¹ä¸Šç»‘å®šäº‹ä»¶)
 *
 * éœ€è¦ç›‘å¬ç”¨æˆ·ç‚¹å‡» document.body çš„åŠ¨ä½œ, æˆ‘ä»¬å¯ä»¥è®¢é˜… document.body ä¸Šçš„ click äº‹ä»¶
 * å½“ body èŠ‚ç‚¹è¢«æƒ¦è®°æ—¶, body èŠ‚ç‚¹ä¾¿ä¼šå‘è®¢é˜…è€…å‘å¸ƒè¿™ä¸ªæ¶ˆæ¯
 *
 * æˆ‘ä»¬å¯ä»¥éšæ„å¢åŠ æˆ–è€…åˆ é™¤è®¢é˜…è€…, å¢åŠ ä»»ä½•è®¢é˜…è€…éƒ½ä¸ä¼šå½±å“å‘å¸ƒè€…ä»£ç çš„ç¼–å†™
 *
 * @warn æ‰‹åŠ¨è§¦å‘äº‹ä»¶: IE ä¸‹ä½¿ç”¨ fireEvent, æ ‡å‡†æµè§ˆå™¨ä¸‹ç”¨ dispatchEvent å®ç°
 **/
document.addEventListener(
  'click',
  function () {
    console.log('clicked');
  },
  false
);

document.body.click(); // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»

/**
 * ğŸŒ° : è‡ªå®šä¹‰äº‹ä»¶
 *
 *  å®ç°æ­¥éª¤:
 *      - æŒ‡å®šè°å……å½“å‘å¸ƒè€…
 *      - ç»™å‘å¸ƒè€…æ·»åŠ ä¸€ä¸ªç¼“å­˜åˆ—è¡¨, ç”¨äºå­˜æ”¾å›è°ƒå‡½æ•°ä»¥ä¾¿äºé€šçŸ¥è®¢é˜…è€…
 *      - æœ€åå‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™, å‘å¸ƒè€…ä¼šéå†è¿™ä¸ªç¼“å­˜åˆ—è¡¨, ä¾æ¬¡é€šçŸ¥é‡Œé¢å­˜æ”¾çš„è®¢é˜…è€…å›è°ƒå‡½æ•°
 *      - è¿˜å¯ä»¥å¾€å›è°ƒå‡½æ•°é‡Œå¡«å…¥ä¸€äº›å‚æ•°, è®¢é˜…è€…å¯ä»¥æ¥æ”¶è¿™äº›å‚æ•°, åœ¨è¿›è¡Œå„è‡ªçš„å¤„ç†
 */

var salesOffices = {}; // å®šä¹‰å”®æ¥¼å¤„

salesOffices.clientList = []; // ç¼“å­˜åˆ—è¡¨, å­˜æ”¾è®¢é˜…è€…çš„å›è°ƒå‡½æ•°

// å¢åŠ è®¢é˜…è€…
salesOffices.listen = function (fn) {
  this.clientList.push(fn); // è®¢é˜…æ¶ˆæ¯å­˜æ”¾æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨é‡Œ
};

// å‘å¸ƒæ¶ˆæ¯
salesOffices.trigger = function () {
  for (var i = 0, fn; (fn = this.clientList[i++]); ) {
    fn.apply(this, arguments); // arguments: å‘å¸ƒæ¶ˆæ¯æ—¶å¸¦ä¸Šçš„å‚æ•°
  }
};

/**
 * æµ‹è¯•ç”¨ä¾‹
 * å­˜åœ¨é—®é¢˜: æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯
 */

/**ç”¨æˆ·ä¸€è®¢é˜…æ¶ˆæ¯ */
salesOffices.listen(function (price, square) {
  console.log(`ä»·æ ¼=${price}`);
  console.log(`å¹³æ–¹æ•°=${square}`);
});
/**ç”¨æˆ·äºŒè®¢é˜…æ¶ˆæ¯ */
salesOffices.listen(function (price, square) {
  console.log(`ä»·æ ¼=${price}`);
  console.log(`å¹³æ–¹æ•°=${square}`);
});

salesOffices.trigger(20000, 88);
salesOffices.trigger(30000, 110);

/**ä¿®æ”¹ */
var salesOffices = {}; // å®šä¹‰å”®æ¥¼å¤„

salesOffices.clientList = []; // ç¼“å­˜åˆ—è¡¨, å­˜æ”¾è®¢é˜…è€…çš„å›è°ƒå‡½æ•°

// å¢åŠ è®¢é˜…è€…
salesOffices.listen = function (key, fn) {
  /**å¦‚æœè¿˜æ²¡æœ‰è®¢é˜…æ­¤ç±»æ¶ˆæ¯, ç»™è¯¥ç±»æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ—è¡¨ */
  if (!this.salesOffices[key]) this.salesOffices[key] = [];
  /**è®¢é˜…æ¶ˆæ¯å­˜æ”¾æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨é‡Œ */
  this.clientList[key].push(fn);
};

// å‘å¸ƒæ¶ˆæ¯
salesOffices.trigger = function () {
  var key = Array.prototype.shift.call(arguments), // å–å‡ºæ¶ˆæ¯ç±»å‹
    fns = this.clientList[key]; // å–å‡ºè¯¥æ¶ˆæ¯å¯¹åº”çš„å›è°ƒå‡½æ•°

  if (!fns || fns.length === 0) return false; // æ²¡æœ‰è¯¥æ¶ˆæ¯ç±»å‹, åˆ™è¿”å›

  for (var i = 0, fn; (fn = fns[i]); ) {
    fn.apply(this, arguments); // arguments: å‘å¸ƒæ¶ˆæ¯æ—¶å¸¦ä¸Šçš„å‚æ•°
  }
};

/**ç”¨æˆ·ä¸€è®¢é˜…æ¶ˆæ¯ */
/**è®¢é˜… square:88 çš„æ¶ˆæ¯  */
salesOffices.listen('square:88', function (price, square) {
  console.log(`ä»·æ ¼=${price}`);
  console.log(`å¹³æ–¹æ•°=${square}`);
});
/**è®¢é˜… square:110 çš„æ¶ˆæ¯  */
salesOffices.listen('square:110', function (price, square) {
  console.log(`ä»·æ ¼=${price}`);
  console.log(`å¹³æ–¹æ•°=${square}`);
});
/**å‘å¸ƒ square:88 çš„æ¶ˆæ¯ */
salesOffices.trigger('square:88', 20000, 88);
/**å‘å¸ƒ square:110 çš„æ¶ˆæ¯ */
salesOffices.trigger('square:110', 30000, 110);

/**
 * ğŸŒ° : é€šç”¨çš„å‘å¸ƒè®¢é˜…å®ç°
 */
var event = {
  clientList: {},
  listen: function (key, fn) {
    if (!this.clientList[key]) this.clientList[key] = [];
    this.clientList[key].push(fn); // è®¢é˜…æ¶ˆæ¯æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨é‡Œ
  },
  trigger: function () {
    var key = Array.prototype.shift.call(arguments),
      fns = this.clientList[key];

    if (!fns || fns.length === 0) return false; // å¦‚æœæ²¡æœ‰ç»‘å®šå¯¹åº”çš„æ¶ˆæ¯

    for (var i = 0, fn; (fn = fns[i]); ) fn.apply(this, arguments); // arguments æ˜¯ trigger æ—¶å¸¦ä¸Šçš„å‚æ•°
  },
};

/** installEvent: ç»™æ‰€æœ‰å¯¹è±¡éƒ½åŠ¨æ€æ·»åŠ å‘å¸ƒè®¢é˜…åŠŸèƒ½ */
var installEvent = function (obj) {
  for (var i in obj) obj[i] = event[i];
};

var salesOffices = {}; // å®šä¹‰å”®æ¥¼å¤„
/**ç»™ salesOffices åŠ¨æ€æ·»åŠ  å‘å¸ƒè®¢é˜… */
installEvent(salesOffices)